{{> header }}

<!-- 登录表单 begin-->
<div>
    <form id="loginFm" action="{{ loginUrl }}" method="post">
        <input type="hidden" name="_token" value="<?php echo csrf_token(); ?>">
        名称: <input type="text" name="name" id="name" /><br />
        密码: <input type="password" minlength="6" maxlength="32" name="password" id="password"><br/>
        <input type="button" onclick="login()" value="登录" id="loginBtn" />
    </form>
    <a href="{{ registerUrl }}"><input type="button" value="注册" /></a>

</div>

<script>
    /**
     * @returns {boolean}
     */
    function login() {

        if (false == checkForm()) {
            return false;
        }
        if ($('#loginBtn').val() == "登录") {
            $('#loginBtn').val('正在登录');
            $.ajax({
                type: "POST",
                url: "{{ loginUrl }}",
                data: $('#loginFm').serialize(),
                dataType: "json",
                success: function (msg) {
                    alert(msg.message);
                    if (msg.code == 0){
                        return window.location.href = msg.redirectUrl;
                    }
                }
            });

            $('#loginBtn').val('登录');
        }
    }
    /**
     * 检查form
     * @returns {boolean}
     */
    function checkForm() {
        if (!$('#name').val()){
            alert('提示\n\n请输入有效的用户名！');
            $('#name').focus();
            return false;

        }
        if (!$('#password').val()){
            alert('提示\n\n请输入有效的密码！');
            $('#password').focus();
            return false;
        }

        return true;
    }
</script>

{{> footer }}